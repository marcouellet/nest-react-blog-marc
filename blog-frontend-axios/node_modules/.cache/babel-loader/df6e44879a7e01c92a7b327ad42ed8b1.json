{"ast":null,"code":"import jwtDecode from 'jwt-decode';\nimport API, { setToken } from './APIUtils';\nimport { setLocalStorage, removeLocalStorage } from '../../utils/utils';\nexport const USER_KEY = 'user';\nexport const TOKEN_KEY = 'token';\nexport function isTokenValid(token) {\n  try {\n    const decoded_jwt = jwtDecode(token);\n    const current_time = Date.now().valueOf() / 1000;\n    return decoded_jwt.exp > current_time;\n  } catch (error) {\n    return false;\n  }\n}\n\nfunction handleUserAuth(user) {\n  setLocalStorage(USER_KEY, user);\n\n  if (user.token) {\n    setLocalStorage(TOKEN_KEY, user.token);\n    setToken(JSON.stringify(user.token));\n  }\n}\n\nfunction handleToken(authToken) {\n  setLocalStorage(TOKEN_KEY, authToken);\n  setToken(JSON.stringify(authToken));\n}\n\nasync function getCurrentUser() {\n  return new Promise((resolve, reject) => {\n    API.get('/auth/user').then(response => {\n      resolve(response.data);\n    }).catch(error => {\n      reject(error);\n    });\n  });\n}\n\nasync function login(email, password) {\n  return new Promise((resolve, reject) => {\n    API.post('/auth/login', {\n      email,\n      password\n    }).then(response => {\n      handleUserAuth(response.data);\n      resolve(response.data);\n    }).catch(error => {\n      reject(error);\n    });\n  });\n}\n\nasync function register(username, email, password) {\n  return new Promise((resolve, reject) => {\n    API.post('/auth/register', {\n      username,\n      email,\n      password\n    }).then(response => {\n      handleUserAuth(response.data);\n      resolve(response.data);\n    }).catch(error => {\n      reject(error);\n    });\n  });\n}\n\nfunction logout() {\n  removeLocalStorage(USER_KEY);\n  removeLocalStorage(TOKEN_KEY);\n  setToken(null);\n}\n\nconst AUTHAPI = {\n  getCurrentUser,\n  login,\n  register,\n  logout\n};\nexport default AUTHAPI;","map":{"version":3,"sources":["F:/Documents/Documents/_Nest/nest-react-blog-marc/blog-frontend-axios/src/services/api/AuthAPI.ts"],"names":["jwtDecode","API","setToken","setLocalStorage","removeLocalStorage","USER_KEY","TOKEN_KEY","isTokenValid","token","decoded_jwt","current_time","Date","now","valueOf","exp","error","handleUserAuth","user","JSON","stringify","handleToken","authToken","getCurrentUser","Promise","resolve","reject","get","then","response","data","catch","login","email","password","post","register","username","logout","AUTHAPI"],"mappings":"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","sourcesContent":["import jwtDecode from 'jwt-decode';\r\nimport API, { setToken } from './APIUtils';\r\nimport { User } from '../../types';\r\nimport { setLocalStorage, removeLocalStorage } from '../../utils/utils';\r\nimport { IAuthToken } from '../../types';\r\n\r\nexport const USER_KEY = 'user';\r\nexport const TOKEN_KEY = 'token';\r\n\r\ntype JWTPayload = {\r\n  id: string;\r\n  username: string;\r\n  exp: number;\r\n};\r\n\r\nexport function isTokenValid(token: string) {\r\n  try {\r\n    const decoded_jwt: JWTPayload = jwtDecode(token);\r\n    const current_time = Date.now().valueOf() / 1000;\r\n    return decoded_jwt.exp > current_time;\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction handleUserAuth(user: User) {\r\n  setLocalStorage(USER_KEY, user);\r\n  if (user.token) {\r\n    setLocalStorage(TOKEN_KEY, user.token);\r\n    setToken(JSON.stringify(user.token));  \r\n  }\r\n}\r\n\r\nfunction handleToken(authToken: IAuthToken) {\r\n  setLocalStorage(TOKEN_KEY, authToken);\r\n  setToken(JSON.stringify(authToken));\r\n}\r\n\r\nasync function  getCurrentUser(): Promise<User> {\r\n  return new Promise((resolve, reject) => {\r\n    API.get<User>('/auth/user')\r\n      .then(response => {\r\n        resolve(response.data);\r\n      })\r\n      .catch(error => {\r\n        reject(error);\r\n      });\r\n  });\r\n}\r\n\r\nasync function login(email: string, password: string): Promise<User> {\r\n  return new Promise((resolve, reject) => {\r\n    API.post<User>('/auth/login', { email, password })\r\n      .then(response => {\r\n        handleUserAuth(response.data);\r\n        resolve(response.data);\r\n      })\r\n      .catch(error => {\r\n        reject(error);\r\n      });\r\n  });\r\n}\r\n\r\nasync function register(username: string, email: string, password: string) : Promise<User> {\r\n  return new Promise((resolve, reject) => {\r\n    API.post<User>('/auth/register', { username, email, password })\r\n      .then(response => {\r\n        handleUserAuth(response.data);\r\n        resolve(response.data);\r\n      })\r\n      .catch(error => {\r\n        reject(error);\r\n      });\r\n  });\r\n}\r\n\r\nfunction logout() {\r\n  removeLocalStorage(USER_KEY);\r\n  removeLocalStorage(TOKEN_KEY);\r\n  setToken(null);\r\n}\r\n\r\nconst AUTHAPI = {getCurrentUser, login, register, logout}\r\n\r\nexport default AUTHAPI\r\n"]},"metadata":{},"sourceType":"module"}