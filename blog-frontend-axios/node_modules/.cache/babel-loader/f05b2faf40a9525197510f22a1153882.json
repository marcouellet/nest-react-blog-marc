{"ast":null,"code":"import _objectSpread from \"F:\\\\Documents\\\\Documents\\\\_Nest\\\\nest-react-blog-marc\\\\blog-frontend-axios\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";\nimport _slicedToArray from \"F:\\\\Documents\\\\Documents\\\\_Nest\\\\nest-react-blog-marc\\\\blog-frontend-axios\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"F:\\\\Documents\\\\Documents\\\\_Nest\\\\nest-react-blog-marc\\\\blog-frontend-axios\\\\src\\\\components\\\\Navbar.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { Link, useNavigate } from 'react-router-dom';\nimport useAuth from '../contexts/auth';\nimport { createActionLogout } from '../reducers/auth';\nimport AUTHAPI from '../services/api/AuthApiService';\nimport { toast } from \"react-toastify\";\nimport { UserRole, createUserForUpdate } from '../types';\nimport ImageUpload from './common/ImageUpload';\nimport ImageResize from './common/ImageResize';\nimport { createActionLoading, createActionSessionExpired } from '../reducers/auth';\nimport { UserApiService } from \"../services/api/UserApiService\";\nimport { checkUnauthorized, checkForbidden } from '../utils/html.response.utils';\nimport ListErrors from './common/ListErrors';\n\nconst Navbar = () => {\n  const _useAuth = useAuth(),\n        _useAuth$state = _useAuth.state,\n        user = _useAuth$state.user,\n        isAuthenticated = _useAuth$state.isAuthenticated,\n        isLoading = _useAuth$state.isLoading,\n        dispatch = _useAuth.dispatch;\n\n  const navigate = useNavigate();\n\n  const _useState = useState(),\n        _useState2 = _slicedToArray(_useState, 2),\n        userImage = _useState2[0],\n        setUserImage = _useState2[1];\n\n  const _useState3 = useState(),\n        _useState4 = _slicedToArray(_useState3, 2),\n        imageChanged = _useState4[0],\n        setImageChanged = _useState4[1];\n\n  const _React$useState = React.useState(),\n        _React$useState2 = _slicedToArray(_React$useState, 2),\n        errorList = _React$useState2[0],\n        setErrorList = _React$useState2[1];\n\n  useEffect(() => {\n    setImageData(user === null || user === void 0 ? void 0 : user.image); // eslint-disable-next-line\n  }, [user]);\n\n  const handleLogout = () => {\n    dispatch(createActionLogout());\n    AUTHAPI.logout();\n    toast.info(`${user.username} is logged out`);\n    setTimeout(() => {\n      navigate('/');\n    }, 1500);\n  };\n\n  const isAdministrator = () => isAuthenticated && (user === null || user === void 0 ? void 0 : user.role) === UserRole.ADMIN;\n\n  const handleImageUpload = image => {\n    setImageData(image);\n  };\n\n  const handleDeleteImage = () => {\n    setImageData(undefined);\n  };\n\n  const handleSaveImage = async () => {\n    dispatch(createActionLoading(true));\n    const image = userImage;\n    const userData = createUserForUpdate(_objectSpread({}, user, {\n      image\n    }));\n    await UserApiService.updateUser(user.id, userData).then(() => {\n      handleSaveImageSuccess();\n    }).catch(apiErrors => {\n      handleSubmitFormError(apiErrors);\n    });\n    dispatch(createActionLoading(false));\n  };\n\n  const handleSaveImageSuccess = () => {\n    setImageChanged(false);\n    toast.success(`User image updated successfully...`);\n  };\n\n  const handleSubmitFormError = apiErrors => {\n    if (checkForbidden(apiErrors)) {\n      toast.error(`User update failed, session expired`);\n      dispatch(createActionSessionExpired());\n      navigate('/user');\n    } else if (checkUnauthorized(apiErrors)) {\n      toast.error(`Access denied`);\n    } else {\n      toast.error(`User update failed, see error list`);\n      setErrorList(apiErrors);\n    }\n  };\n\n  const setImageData = image => {\n    var _user$image;\n\n    const isImageDefined = image !== undefined;\n    const isInitialImageDefined = (user === null || user === void 0 ? void 0 : user.image) !== undefined;\n    const imageChanged = isImageDefined !== isInitialImageDefined || isImageDefined && (image === null || image === void 0 ? void 0 : image.base64) !== (user === null || user === void 0 ? void 0 : (_user$image = user.image) === null || _user$image === void 0 ? void 0 : _user$image.base64);\n    setImageChanged(imageChanged);\n    setUserImage(image);\n  };\n\n  const imageMaxSize = {\n    maxWidth: 600,\n    maxHeight: 400\n  };\n  const imageDisplayMaxSize = {\n    maxWidth: 260,\n    maxHeight: 260\n  };\n  return React.createElement(\"header\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"container-fluid position-relative no-side-padding\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    className: \"menu-nav-icon\",\n    \"data-nav-menu\": \"#main-menu\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89\n    },\n    __self: this\n  }, React.createElement(\"i\", {\n    className: \"ion-navicon\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 90\n    },\n    __self: this\n  })), user && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94\n    },\n    __self: this\n  }, React.createElement(\"h5\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95\n    },\n    __self: this\n  }, \"User:\\xA0\", user.username, \"\\xA0\", isAdministrator() && '(admin)')), React.createElement(\"div\", {\n    className: \"form-group col-md-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97\n    },\n    __self: this\n  }, errorList && React.createElement(ListErrors, {\n    errors: errorList,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98\n    },\n    __self: this\n  }), React.createElement(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99\n    },\n    __self: this\n  }, React.createElement(\"label\", {\n    className: \"col-md-2\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100\n    },\n    __self: this\n  }, \" Image: \"), userImage && React.createElement(\"button\", {\n    className: \"btn btn-secondary col-md-3\",\n    onClick: () => handleDeleteImage(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102\n    },\n    __self: this\n  }, \"Delete Image\"), imageChanged && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"btn btn-secondary col-md-3\",\n    onClick: () => handleSaveImage(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108\n    },\n    __self: this\n  }, \"Save\"), React.createElement(\"button\", {\n    className: \"btn btn-secondary col-md-3\",\n    onClick: () => handleSaveImage(),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, \"Cancel\")), React.createElement(ImageUpload, {\n    onImageUpload: handleImageUpload,\n    resize: imageMaxSize,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117\n    },\n    __self: this\n  }))), userImage && React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121\n    },\n    __self: this\n  }, React.createElement(ImageResize, {\n    imageData: userImage,\n    resize: imageDisplayMaxSize,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122\n    },\n    __self: this\n  }), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123\n    },\n    __self: this\n  })), React.createElement(\"br\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126\n    },\n    __self: this\n  })), React.createElement(\"ul\", {\n    className: \"main-menu visible-on-click\",\n    id: \"main-menu\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  }, React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131\n    },\n    __self: this\n  }, \" Home \")), !isLoading && isAuthenticated && React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }, React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/post/create\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133\n    },\n    __self: this\n  }, \" Create Post\")), !isLoading && !isAuthenticated && React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/login\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136\n    },\n    __self: this\n  }, \" Log In \")), !isLoading && !isAuthenticated && React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/register\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  }, \" Register \")), !isLoading && isAdministrator() && React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/user\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142\n    },\n    __self: this\n  }, \" Admin User\")), !isLoading && isAdministrator() && React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, React.createElement(Link, {\n    className: \"nav-link\",\n    to: \"/category\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145\n    },\n    __self: this\n  }, \" Admin Category\")), !isLoading && user && React.createElement(\"li\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  }, React.createElement(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149\n    },\n    __self: this\n  }, React.createElement(\"button\", {\n    className: \"btn\",\n    onClick: handleLogout,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 150\n    },\n    __self: this\n  }, \"Log Out\"))))));\n};\n\nexport default Navbar;","map":{"version":3,"sources":["F:/Documents/Documents/_Nest/nest-react-blog-marc/blog-frontend-axios/src/components/Navbar.tsx"],"names":["React","useState","useEffect","Link","useNavigate","useAuth","createActionLogout","AUTHAPI","toast","UserRole","createUserForUpdate","ImageUpload","ImageResize","createActionLoading","createActionSessionExpired","UserApiService","checkUnauthorized","checkForbidden","ListErrors","Navbar","state","user","isAuthenticated","isLoading","dispatch","navigate","userImage","setUserImage","imageChanged","setImageChanged","errorList","setErrorList","setImageData","image","handleLogout","logout","info","username","setTimeout","isAdministrator","role","ADMIN","handleImageUpload","handleDeleteImage","undefined","handleSaveImage","userData","updateUser","id","then","handleSaveImageSuccess","catch","apiErrors","handleSubmitFormError","success","error","isImageDefined","isInitialImageDefined","base64","imageMaxSize","maxWidth","maxHeight","imageDisplayMaxSize"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Link, useNavigate } from 'react-router-dom';\r\nimport useAuth from '../contexts/auth';\r\nimport { createActionLogout } from '../reducers/auth';\r\nimport AUTHAPI from '../services/api/AuthApiService';\r\nimport { toast } from \"react-toastify\";\r\nimport { UserRole, ImageData, ImageSizeProps, createUserForUpdate, IUpdateUser, IErrors } from '../types';\r\nimport ImageUpload from './common/ImageUpload';\r\nimport ImageResize from './common/ImageResize';\r\nimport { createActionLoading, createActionSessionExpired } from '../reducers/auth';\r\nimport { UserApiService } from \"../services/api/UserApiService\";\r\nimport { checkUnauthorized, checkForbidden } from '../utils/html.response.utils';\r\nimport ListErrors from './common/ListErrors';\r\n\r\nconst Navbar = () => {\r\n    const { state: { user, isAuthenticated, isLoading}, dispatch } = useAuth();\r\n    const navigate = useNavigate();\r\n    const [userImage, setUserImage] = useState<ImageData>();\r\n    const [imageChanged, setImageChanged] = useState<boolean>();\r\n    const [errorList, setErrorList] = React.useState<IErrors | null>();\r\n\r\n    useEffect(() => {\r\n        setImageData(user?.image);\r\n      // eslint-disable-next-line\r\n      }, [user]);\r\n\r\n     const handleLogout = () => {\r\n        dispatch(createActionLogout());\r\n        AUTHAPI.logout();\r\n        toast.info(`${user!.username} is logged out`);\r\n        setTimeout(() => {\r\n            navigate('/');\r\n          }, 1500);\r\n      };\r\n\r\n    const isAdministrator = () => isAuthenticated && user?.role === UserRole.ADMIN;\r\n\r\n    const handleImageUpload = (image: ImageData) => {\r\n        setImageData(image);\r\n      }\r\n      \r\n    const handleDeleteImage = () => {\r\n        setImageData(undefined);\r\n    }\r\n\r\n    const handleSaveImage = async () => {\r\n        dispatch(createActionLoading(true));\r\n        const image: ImageData | undefined = userImage;\r\n        const userData: IUpdateUser = createUserForUpdate({...user!, image});\r\n        await UserApiService.updateUser(user!.id!, userData)\r\n        .then(() => {handleSaveImageSuccess(); })\r\n        .catch((apiErrors: IErrors) =>  { handleSubmitFormError(apiErrors); });\r\n        dispatch(createActionLoading(false));\r\n    }\r\n\r\n    const handleSaveImageSuccess = () => {\r\n        setImageChanged(false);\r\n        toast.success(`User image updated successfully...`);\r\n    }\r\n    \r\n    const handleSubmitFormError = (apiErrors: IErrors) => {\r\n    if (checkForbidden(apiErrors)) {\r\n        toast.error(`User update failed, session expired`);\r\n        dispatch(createActionSessionExpired());\r\n        navigate('/user'); \r\n    } else if (checkUnauthorized(apiErrors)) {\r\n        toast.error(`Access denied`);\r\n    } else {\r\n        toast.error(`User update failed, see error list`);\r\n        setErrorList(apiErrors);      \r\n    }\r\n    }\r\n\r\n    const setImageData = (image: ImageData | undefined) => {\r\n        const isImageDefined = image !== undefined;\r\n        const isInitialImageDefined = user?.image !== undefined;\r\n        const imageChanged = (isImageDefined !== isInitialImageDefined) ||\r\n                              (isImageDefined && image?.base64 !== user?.image?.base64);\r\n        setImageChanged(imageChanged);\r\n        setUserImage(image);\r\n    }\r\n\r\n    const imageMaxSize: ImageSizeProps = {maxWidth:600, maxHeight:400};\r\n    const imageDisplayMaxSize: ImageSizeProps = {maxWidth:260, maxHeight:260};\r\n\r\n      return (\r\n        <header>\r\n            <div className=\"container-fluid position-relative no-side-padding\">\r\n                <div className=\"menu-nav-icon\" data-nav-menu=\"#main-menu\">\r\n                    <i className=\"ion-navicon\" />\r\n                </div>\r\n                { user && (\r\n                    <div>\r\n                        <div>\r\n                            <h5>User:&nbsp;{user.username}&nbsp;{isAdministrator() && '(admin)'}</h5>\r\n                        </div>\r\n                        <div className=\"form-group col-md-5\">\r\n                        {errorList && <ListErrors errors={errorList} />}\r\n                            <div className=\"row\">\r\n                                <label className=\"col-md-2\"> Image: </label>\r\n                                { userImage && \r\n                                    <button className=\"btn btn-secondary col-md-3\"  onClick={ () => handleDeleteImage() } >\r\n                                        Delete Image\r\n                                    </button> \r\n                                }\r\n                                { imageChanged && \r\n                                    <div>\r\n                                        <button className=\"btn btn-secondary col-md-3\"  onClick={ () => handleSaveImage() } >\r\n                                            Save\r\n                                        </button> \r\n                                        <button className=\"btn btn-secondary col-md-3\"  onClick={ () => handleSaveImage() } >\r\n                                           Cancel\r\n                                        </button>    \r\n                                    </div>                                 \r\n                                                                   \r\n                                }  \r\n                                <ImageUpload onImageUpload={handleImageUpload} resize={imageMaxSize}/>                \r\n                            </div>\r\n                        </div>\r\n                        { userImage && \r\n                        <div>\r\n                            <ImageResize imageData={userImage} resize={imageDisplayMaxSize}/>\r\n                            <br/>\r\n                        </div>\r\n          }\r\n          <br/>\r\n\r\n                    </div>                \r\n                )}\r\n                <ul className=\"main-menu visible-on-click\" id=\"main-menu\">\r\n                    <li><Link className={\"nav-link\"} to={\"/\"}> Home </Link></li>\r\n                    {!isLoading && isAuthenticated && (\r\n                        <li><Link className={\"nav-link\"} to={\"/post/create\"}> Create Post</Link></li>\r\n                    )}\r\n                    {!isLoading && !isAuthenticated && (\r\n                        <li><Link className={\"nav-link\"} to={\"/login\"}> Log In </Link></li>\r\n                    )}\r\n                    {!isLoading && !isAuthenticated && (\r\n                        <li><Link className={\"nav-link\"} to={\"/register\"}> Register </Link></li>\r\n                    )}\r\n                    {!isLoading && isAdministrator() && (\r\n                        <li><Link className={\"nav-link\"} to={\"/user\"}> Admin User</Link></li>\r\n                    )}\r\n                    {!isLoading && isAdministrator() && (\r\n                        <li><Link className={\"nav-link\"} to={\"/category\"}> Admin Category</Link></li>\r\n                    )}\r\n                    {!isLoading && user && (\r\n                        <li>\r\n                            <div>\r\n                                <button className=\"btn\" onClick={handleLogout}>\r\n                                    Log Out \r\n                                </button>\r\n                            </div>\r\n                        </li>\r\n                    )}\r\n                </ul>\r\n            </div>\r\n        </header>\r\n    );\r\n}\r\n\r\nexport default Navbar;\r\n"]},"metadata":{},"sourceType":"module"}