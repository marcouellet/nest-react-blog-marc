{"ast":null,"code":"import jwtDecode from 'jwt-decode';\nimport API from './APIUtils';\nimport TokenService from './TokenService';\nexport function isTokenValid(token) {\n  try {\n    const decoded_jwt = jwtDecode(token);\n    const current_time = Date.now().valueOf() / 1000;\n    return decoded_jwt.exp > current_time;\n  } catch (_) {\n    return false;\n  }\n}\n\nfunction getCurrentUser() {\n  return TokenService.getUser();\n}\n\n;\n\nasync function login(email, password) {\n  return new Promise((resolve, reject) => {\n    const loginParms = {\n      email,\n      password\n    };\n    API.post('/auth/login', loginParms).then(response => {\n      TokenService.setUser(response.data);\n      resolve(response.data);\n    }); // .catch(error => {\n    //   reject(error);\n    // });\n  });\n}\n\nasync function register(username, email, password) {\n  return new Promise((resolve, reject) => {\n    const registerParms = {\n      username,\n      email,\n      password\n    };\n    API.post('/auth/register', registerParms).then(response => {\n      TokenService.setUser(response.data);\n      resolve(response.data);\n    }); // .catch(error => {\n    //   reject(error);\n    // });\n  });\n}\n\nasync function refresh(user) {\n  // return new Promise((resolve, reject) => {\n  //   const { authtoken, authrefreshtoken } = user;\n  //   const refreshParms: IRefresh = { authtoken, authrefreshtoken };\n  //   API.post<User>('/auth/refresh', refreshParms)\n  //     .then(response => {\n  //       TokenService.setUser(response.data);\n  //       resolve(response.data);\n  //     })\n  //     .catch(error => {\n  //       reject(error);\n  //     });\n  // });\n  const authtoken = user.authtoken,\n        authrefreshtoken = user.authrefreshtoken;\n  const refreshParms = {\n    authtoken,\n    authrefreshtoken\n  };\n  return API.post('/auth/refresh', refreshParms).then(response => {\n    TokenService.setUser(response.data);\n    return response.data;\n  });\n}\n\nfunction logout() {\n  TokenService.removeUser();\n}\n\nconst AUTHAPI = {\n  getCurrentUser,\n  login,\n  register,\n  refresh,\n  logout\n};\nexport default AUTHAPI;","map":{"version":3,"sources":["F:/Documents/Documents/_Nest/nest-react-blog-marc/blog-frontend-axios/src/services/api/AuthAPI.ts"],"names":["jwtDecode","API","TokenService","isTokenValid","token","decoded_jwt","current_time","Date","now","valueOf","exp","_","getCurrentUser","getUser","login","email","password","Promise","resolve","reject","loginParms","post","then","response","setUser","data","register","username","registerParms","refresh","user","authtoken","authrefreshtoken","refreshParms","logout","removeUser","AUTHAPI"],"mappings":"AAAA,OAAOA,SAAP,MAAsB,YAAtB;AACA,OAAOC,GAAP,MAAgB,YAAhB;AAEA,OAAOC,YAAP,MAAyB,gBAAzB;AAEA,OAAO,SAASC,YAAT,CAAsBC,KAAtB,EAAqC;AAC1C,MAAI;AACF,UAAMC,WAAuB,GAAGL,SAAS,CAAaI,KAAb,CAAzC;AACA,UAAME,YAAY,GAAGC,IAAI,CAACC,GAAL,GAAWC,OAAX,KAAuB,IAA5C;AACA,WAAOJ,WAAW,CAACK,GAAZ,GAAkBJ,YAAzB;AACD,GAJD,CAIE,OAAOK,CAAP,EAAU;AACV,WAAO,KAAP;AACD;AACF;;AAED,SAASC,cAAT,GAAgC;AAC9B,SAAOV,YAAY,CAACW,OAAb,EAAP;AACD;;AAAA;;AAED,eAAeC,KAAf,CAAqBC,KAArB,EAAoCC,QAApC,EAAqE;AACnE,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMC,UAAkB,GAAG;AAAEL,MAAAA,KAAF;AAASC,MAAAA;AAAT,KAA3B;AACAf,IAAAA,GAAG,CAACoB,IAAJ,CAAe,aAAf,EAA8BD,UAA9B,EACGE,IADH,CACQC,QAAQ,IAAI;AAChBrB,MAAAA,YAAY,CAACsB,OAAb,CAAqBD,QAAQ,CAACE,IAA9B;AACAP,MAAAA,OAAO,CAACK,QAAQ,CAACE,IAAV,CAAP;AACD,KAJH,EAFsC,CAOpC;AACA;AACA;AACH,GAVM,CAAP;AAWD;;AAED,eAAeC,QAAf,CAAwBC,QAAxB,EAA0CZ,KAA1C,EAAyDC,QAAzD,EAA2F;AACzF,SAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,UAAMS,aAAwB,GAAG;AAAED,MAAAA,QAAF;AAAYZ,MAAAA,KAAZ;AAAmBC,MAAAA;AAAnB,KAAjC;AACAf,IAAAA,GAAG,CAACoB,IAAJ,CAAe,gBAAf,EAAiCO,aAAjC,EACGN,IADH,CACQC,QAAQ,IAAI;AAChBrB,MAAAA,YAAY,CAACsB,OAAb,CAAqBD,QAAQ,CAACE,IAA9B;AACAP,MAAAA,OAAO,CAACK,QAAQ,CAACE,IAAV,CAAP;AACD,KAJH,EAFsC,CAOpC;AACA;AACA;AACH,GAVM,CAAP;AAWD;;AAED,eAAeI,OAAf,CAAuBC,IAAvB,EAAmD;AACjD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZiD,QAcvCC,SAduC,GAcPD,IAdO,CAcvCC,SAduC;AAAA,QAc5BC,gBAd4B,GAcPF,IAdO,CAc5BE,gBAd4B;AAe/C,QAAMC,YAAsB,GAAG;AAAEF,IAAAA,SAAF;AAAaC,IAAAA;AAAb,GAA/B;AACA,SAAO/B,GAAG,CAACoB,IAAJ,CAAe,eAAf,EAAgCY,YAAhC,EACJX,IADI,CACCC,QAAQ,IAAI;AAChBrB,IAAAA,YAAY,CAACsB,OAAb,CAAqBD,QAAQ,CAACE,IAA9B;AACA,WAAOF,QAAQ,CAACE,IAAhB;AACD,GAJI,CAAP;AAMH;;AAED,SAASS,MAAT,GAAkB;AAChBhC,EAAAA,YAAY,CAACiC,UAAb;AACD;;AAED,MAAMC,OAAO,GAAG;AAACxB,EAAAA,cAAD;AAAiBE,EAAAA,KAAjB;AAAwBY,EAAAA,QAAxB;AAAkCG,EAAAA,OAAlC;AAA2CK,EAAAA;AAA3C,CAAhB;AAEA,eAAeE,OAAf","sourcesContent":["import jwtDecode from 'jwt-decode';\r\nimport API from './APIUtils';\r\nimport { User, ILogin, IRegister, IRefresh, JWTPayload, IAuthToken } from '../../types';\r\nimport TokenService from './TokenService';\r\n\r\nexport function isTokenValid(token: string) {\r\n  try {\r\n    const decoded_jwt: JWTPayload = jwtDecode<JWTPayload>(token);\r\n    const current_time = Date.now().valueOf() / 1000;\r\n    return decoded_jwt.exp > current_time;\r\n  } catch (_) {\r\n    return false;\r\n  }\r\n}\r\n\r\nfunction getCurrentUser(): User {\r\n  return TokenService.getUser();\r\n};\r\n\r\nasync function login(email: string, password: string): Promise<User> {\r\n  return new Promise((resolve, reject) => {\r\n    const loginParms: ILogin = { email, password }\r\n    API.post<User>('/auth/login', loginParms)\r\n      .then(response => {\r\n        TokenService.setUser(response.data);\r\n        resolve(response.data);\r\n      });\r\n      // .catch(error => {\r\n      //   reject(error);\r\n      // });\r\n  });\r\n}\r\n\r\nasync function register(username: string, email: string, password: string) : Promise<User> {\r\n  return new Promise((resolve, reject) => {\r\n    const registerParms: IRegister = { username, email, password }\r\n    API.post<User>('/auth/register', registerParms)\r\n      .then(response => {\r\n        TokenService.setUser(response.data);\r\n        resolve(response.data);\r\n      });\r\n      // .catch(error => {\r\n      //   reject(error);\r\n      // });\r\n  });\r\n}\r\n\r\nasync function refresh(user: User) : Promise<User> {\r\n  // return new Promise((resolve, reject) => {\r\n  //   const { authtoken, authrefreshtoken } = user;\r\n  //   const refreshParms: IRefresh = { authtoken, authrefreshtoken };\r\n  //   API.post<User>('/auth/refresh', refreshParms)\r\n  //     .then(response => {\r\n  //       TokenService.setUser(response.data);\r\n  //       resolve(response.data);\r\n  //     })\r\n  //     .catch(error => {\r\n  //       reject(error);\r\n  //     });\r\n  // });\r\n\r\n    const { authtoken, authrefreshtoken } = user;\r\n    const refreshParms: IRefresh = { authtoken, authrefreshtoken };\r\n    return API.post<User>('/auth/refresh', refreshParms)\r\n      .then(response => {\r\n        TokenService.setUser(response.data);\r\n        return response.data;\r\n      });\r\n\r\n}\r\n\r\nfunction logout() {\r\n  TokenService.removeUser();\r\n}\r\n\r\nconst AUTHAPI = {getCurrentUser, login, register, refresh, logout}\r\n\r\nexport default AUTHAPI\r\n"]},"metadata":{},"sourceType":"module"}