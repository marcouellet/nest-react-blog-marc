{"ast":null,"code":"import _slicedToArray from \"F:\\\\Documents\\\\Documents\\\\_Nest\\\\nest-react-blog-marc\\\\blog-frontend-axios\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"F:\\\\Documents\\\\Documents\\\\_Nest\\\\nest-react-blog-marc\\\\blog-frontend-axios\\\\src\\\\components\\\\auth\\\\sessionTimeoutHandler.tsx\";\nimport React, { useEffect, useState } from 'react';\nimport useAuth from '../../contexts/auth';\nimport { useNavigate } from 'react-router-dom';\nimport AUTHAPI from '../../services/api/AuthApiService';\nimport { createActionLogout, createActionLoadUser, createActionLoading } from '../../reducers/auth';\nimport { useConfirmationModalContext } from \"../../contexts/modalConfirmationContext\";\nimport { toast } from \"react-toastify\";\n\nconst SessionTimeoutHandler = () => {\n  const modalContext = useConfirmationModalContext();\n\n  const _useAuth = useAuth(),\n        state = _useAuth.state,\n        dispatch = _useAuth.dispatch;\n\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        refresh = _useState2[0],\n        setRefresh = _useState2[1];\n\n  const navigate = useNavigate();\n\n  const showSessionTimeoutModel = async () => {\n    return modalContext.showConfirmation(`${state.user.username} session expired!`, React.createElement(\"div\", {\n      style: {\n        border: \"2px solid blue\",\n        padding: \"10px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 19\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 20\n      },\n      __self: this\n    }, \"Do you want to stay logged in?\")));\n  };\n\n  const handleLogout = () => {\n    if (state.isAuthenticated) {\n      dispatch(createActionLogout());\n      AUTHAPI.logout();\n      toast.info(`${state.user.username} is logged out`);\n      navigate('/');\n    }\n  };\n\n  const handleRefresh = async () => {\n    dispatch(createActionLoading(true));\n    AUTHAPI.refresh(state.user).then(user => {\n      dispatch(createActionLoadUser(user));\n      toast.info(`${user.username} session renewed!`);\n      navigate('/');\n    }).catch(_ => {\n      toast.error(`Refresh session failed, logging out!`);\n      handleLogout();\n    }).finally(() => dispatch(createActionLoading(false)));\n  };\n\n  useEffect(() => {\n    if (state.isAuthenticated && state.isSessionExpired) {\n      showSessionTimeoutModel().then(result => {\n        if (result) {\n          // Session must be renewed\n          setRefresh(true); // handleRefresh();\n        } else {\n          handleLogout();\n        }\n      });\n    } // eslint-disable-next-line\n\n  }, [state]);\n  useEffect(() => {\n    if (refresh) {// handleRefresh();        \n    }\n  }, [refresh]);\n  return React.createElement(React.Fragment, null);\n};\n\nexport default SessionTimeoutHandler;","map":{"version":3,"sources":["F:/Documents/Documents/_Nest/nest-react-blog-marc/blog-frontend-axios/src/components/auth/sessionTimeoutHandler.tsx"],"names":["React","useEffect","useState","useAuth","useNavigate","AUTHAPI","createActionLogout","createActionLoadUser","createActionLoading","useConfirmationModalContext","toast","SessionTimeoutHandler","modalContext","state","dispatch","refresh","setRefresh","navigate","showSessionTimeoutModel","showConfirmation","user","username","border","padding","handleLogout","isAuthenticated","logout","info","handleRefresh","then","catch","_","error","finally","isSessionExpired","result"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,OAAOC,OAAP,MAAoB,qBAApB;AACA,SAASC,WAAT,QAA4B,kBAA5B;AACA,OAAOC,OAAP,MAAoB,mCAApB;AACA,SAASC,kBAAT,EAA6BC,oBAA7B,EAAmDC,mBAAnD,QAA8E,qBAA9E;AACA,SAASC,2BAAT,QAA4C,yCAA5C;AACA,SAASC,KAAT,QAAsB,gBAAtB;;AAEA,MAAMC,qBAAqB,GAAG,MAAM;AAChC,QAAMC,YAAY,GAAGH,2BAA2B,EAAhD;;AADgC,mBAEJN,OAAO,EAFH;AAAA,QAExBU,KAFwB,YAExBA,KAFwB;AAAA,QAEjBC,QAFiB,YAEjBA,QAFiB;;AAAA,oBAGFZ,QAAQ,CAAU,KAAV,CAHN;AAAA;AAAA,QAGzBa,OAHyB;AAAA,QAGhBC,UAHgB;;AAIhC,QAAMC,QAAQ,GAAGb,WAAW,EAA5B;;AAEA,QAAMc,uBAAuB,GAAG,YAA8B;AAC1D,WAAON,YAAY,CAACO,gBAAb,CACF,GAAEN,KAAK,CAACO,IAAN,CAAYC,QAAS,mBADrB,EAGC;AAAK,MAAA,KAAK,EAAE;AAACC,QAAAA,MAAM,EAAE,gBAAT;AAA2BC,QAAAA,OAAO,EAAE;AAApC,OAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OACI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wCADJ,CAHD,CAAP;AAUH,GAXD;;AAaA,QAAMC,YAAY,GAAG,MAAM;AACvB,QAAIX,KAAK,CAACY,eAAV,EAA2B;AACvBX,MAAAA,QAAQ,CAACR,kBAAkB,EAAnB,CAAR;AACAD,MAAAA,OAAO,CAACqB,MAAR;AACAhB,MAAAA,KAAK,CAACiB,IAAN,CAAY,GAAEd,KAAK,CAACO,IAAN,CAAYC,QAAS,gBAAnC;AACAJ,MAAAA,QAAQ,CAAC,GAAD,CAAR;AACH;AACF,GAPH;;AASA,QAAMW,aAAa,GAAG,YAAY;AAC9Bd,IAAAA,QAAQ,CAACN,mBAAmB,CAAC,IAAD,CAApB,CAAR;AACAH,IAAAA,OAAO,CAACU,OAAR,CAAgBF,KAAK,CAACO,IAAtB,EACCS,IADD,CACOT,IAAD,IAAU;AACZN,MAAAA,QAAQ,CAACP,oBAAoB,CAACa,IAAD,CAArB,CAAR;AACAV,MAAAA,KAAK,CAACiB,IAAN,CAAY,GAAEP,IAAI,CAACC,QAAS,mBAA5B;AACAJ,MAAAA,QAAQ,CAAC,GAAD,CAAR;AACC,KALL,EAMCa,KAND,CAMOC,CAAC,IAAI;AACRrB,MAAAA,KAAK,CAACsB,KAAN,CAAa,sCAAb;AACAR,MAAAA,YAAY;AACf,KATD,EAUCS,OAVD,CAUS,MAAMnB,QAAQ,CAACN,mBAAmB,CAAC,KAAD,CAApB,CAVvB;AAWD,GAbH;;AAgBAP,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAIY,KAAK,CAACY,eAAN,IAAyBZ,KAAK,CAACqB,gBAAnC,EAAqD;AACjDhB,MAAAA,uBAAuB,GAAGW,IAA1B,CAAgCM,MAAD,IAAY;AACvC,YAAIA,MAAJ,EAAY;AACR;AACAnB,UAAAA,UAAU,CAAC,IAAD,CAAV,CAFQ,CAGR;AACH,SAJD,MAIO;AACHQ,UAAAA,YAAY;AACf;AACJ,OARD;AAUH,KAZW,CAahB;;AACC,GAdQ,EAcN,CAACX,KAAD,CAdM,CAAT;AAgBAZ,EAAAA,SAAS,CAAC,MAAM;AACZ,QAAIc,OAAJ,EAAa,CACT;AACH;AACJ,GAJQ,EAIN,CAACA,OAAD,CAJM,CAAT;AAMA,SAAO,yCAAP;AACH,CAnED;;AAqEA,eAAeJ,qBAAf","sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport useAuth from '../../contexts/auth';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport AUTHAPI from '../../services/api/AuthApiService';\r\nimport { createActionLogout, createActionLoadUser, createActionLoading } from '../../reducers/auth';\r\nimport { useConfirmationModalContext } from \"../../contexts/modalConfirmationContext\";\r\nimport { toast } from \"react-toastify\";\r\n\r\nconst SessionTimeoutHandler = () => {\r\n    const modalContext = useConfirmationModalContext();\r\n    const { state, dispatch } = useAuth();\r\n    const [refresh, setRefresh] = useState<boolean>(false);\r\n    const navigate = useNavigate();\r\n\r\n    const showSessionTimeoutModel = async (): Promise<boolean> => {\r\n        return modalContext.showConfirmation(\r\n            `${state.user!.username} session expired!`,\r\n            (\r\n                <div style={{border: \"2px solid blue\", padding: \"10px\"}}>\r\n                    <p>\r\n                        Do you want to stay logged in?\r\n                    </p>\r\n                </div>\r\n            )\r\n        );\r\n    }\r\n\r\n    const handleLogout = () => {\r\n        if (state.isAuthenticated) {\r\n            dispatch(createActionLogout());\r\n            AUTHAPI.logout();\r\n            toast.info(`${state.user!.username} is logged out`);\r\n            navigate('/');\r\n        }\r\n      };\r\n\r\n    const handleRefresh = async () => {\r\n        dispatch(createActionLoading(true));\r\n        AUTHAPI.refresh(state.user!)\r\n        .then((user) => {\r\n            dispatch(createActionLoadUser(user));\r\n            toast.info(`${user.username} session renewed!`);\r\n            navigate('/');\r\n            })\r\n        .catch(_ => {\r\n            toast.error(`Refresh session failed, logging out!`);\r\n            handleLogout();\r\n        })\r\n        .finally(() => dispatch(createActionLoading(false)));\r\n      };\r\n\r\n\r\n    useEffect(() => {\r\n        if (state.isAuthenticated && state.isSessionExpired) {\r\n            showSessionTimeoutModel().then((result) => {\r\n                if (result) {\r\n                    // Session must be renewed\r\n                    setRefresh(true);\r\n                    // handleRefresh();\r\n                } else {\r\n                    handleLogout();\r\n                }\r\n            });\r\n    \r\n        }\r\n    // eslint-disable-next-line\r\n    }, [state]);\r\n\r\n    useEffect(() => {\r\n        if (refresh) {\r\n            // handleRefresh();        \r\n        }\r\n    }, [refresh]);\r\n\r\n    return <></>;\r\n}\r\n\r\nexport default SessionTimeoutHandler;"]},"metadata":{},"sourceType":"module"}